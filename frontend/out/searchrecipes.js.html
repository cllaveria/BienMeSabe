<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: searchrecipes.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: searchrecipes.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Cerca de receptes personalitzat: 
 * &lt;p> Mostra per pantalla el resultat de la cerca personalitzada.&lt;/p>
 * &lt;p> Mostra per pantalla el resultat de la cerca per tipus de plat.&lt;/p>
 * 
 * &lt;p> History&lt;/p>
 * 0.1 - Implementació de la cerca de receptes.
 * 0.2 - Implementació de la visualització de mes receptes per tipus de plat.  
 *  
 * @version     0.2
 * @author      Sergio Asensio Ruiz 
 * @copyright   bienmesabe.com
 * 
 */

$(document).ready(function () {

    const $urlSearch = 'http://localhost:8080/api/recipe/getRecipesByFilters/';
    const $urlSearchPlate = 'http://localhost:8080/api/recipe/getRecipesByType/';
    const $urlAllUsers = 'http://localhost:8080/api/user/getUsers';
    const $urlTypePlate = 'http://localhost:8080/api/recipeTypes/getRecipeTypes';
    const $urlLatestRecipes = 'http://localhost:8080/api/recipe/getRecipes';
    const $urlRecipe = 'http://localhost:3000/recetas/ficha?id=';

    let $searchFilters = (window.location.search).substr(1, );
    let $searchId = (window.location.search).substr(1, 3);
    let $searchLatestRecipes = (window.location.search).substr(1, 13);
    let $allUsers = [];
    let $allTypePlate = [];
    let $allRecipes = [];
    let $dinners = [];
    let $typePlate;
    let $userAlias;
    let $dinner;
    let $totalRecipes = [];
    let $countRecipe = 0;
    
    if ($searchFilters.indexOf('dinner') > 1) {
        $allRecipes = $searchFilters.split('_');
        $dinners = $allRecipes[1].split('-');
    }

    $.ajax({
        url: $urlAllUsers,
        type: 'GET',
        async: false,
        success: function ($users) {
            for (let i = 0; i &lt; $users.length; i++) {
                $allUsers[i] = $users[i];
            }
        }
    });

    $.ajax({
        url: $urlTypePlate,
        type: 'GET',
        async: false,
        success: function ($plate) {
            for (let d = 0; d &lt; $plate.length; d++) {
                $allTypePlate[d] = $plate[d];
            }
        }
    })


    if ($searchId == 'id=') {
        $.ajax({
            url: $urlSearchPlate + (window.location.search).substr(4, 5),
            type: 'GET',
            async: false,
            success: function ($recipes) {
                $totalRecipes = $recipes;
                insertRecipes($countRecipe, ($countRecipe + 18), $recipes);
            }
        });
    } else if ($searchLatestRecipes == 'latestRecipes') {
        $.ajax({
            url: $urlLatestRecipes,
            type: 'GET',
            async: false,
            success: function ($recipes) {
                $totalRecipes = $recipes;
                insertRecipes($countRecipe, ($countRecipe + 18), $recipes);
            }
        });
    } else {
        $.ajax({
            url: $urlSearch + $searchFilters,
            type: 'GET',
            async: false,
            success: function ($recipes) {
                if ($recipes.length == 0) {
                    $('.messageError').css('display', 'inline-block')
                } else {
                    $totalRecipes = $recipes;
                    insertRecipes($countRecipe, ($countRecipe + 18), $recipes);
                }
            }
        });
    }

    $(window).scroll(function () {
        if ($(window).scrollTop().toFixed(0) > ($(document).height() - 1100)) {
            insertRecipes($countRecipe, ($countRecipe + 18), $totalRecipes)
        }
    })

    function insertRecipes($min, $max, $recipes) {
        for (let i = $min; i &lt; $max /* $recipes.length */ ; i++) {
            if($recipes[i] == null){
                break;
            }else{
                for (let j = 0; j &lt; $allUsers.length; j++) {
                    //TODO: BORRAR LO COMENTADO
                    if ( /* $allUsers[j].id */ $allUsers[j][0] == $recipes[i].userId) {
                        $userAlias = /* $allUsers[j].alias */ $allUsers[j][4];
                    }
                }
                for (let x = 0; x &lt; $allTypePlate.length; x++) {
                    if ($allTypePlate[x].id == $recipes[i].type) {
                        $typePlate = $allTypePlate[x].name;
                        if (i == 0) {
                            if ((window.location.search).substr(1, 3) == 'id=') {
                                $('.recipes_container').prepend('&lt;div class="tl_typePlate tl_' + $typePlate + '" >' + $typePlate + '&lt;/div>')
                            }
                        }
                    }
                }
                let $forks = getForks($recipes[i].recipeAssessment);
                let $difficult = getDifficult($recipes[i].recipeDifficult);
                receivePlate($recipes[i], $userAlias, $forks, $difficult, $typePlate);
            }
            
        }
        $countRecipe = $max;
    }

    function receivePlate($recipe, $userAlias, $forks, $difficult, $classPlate) {
        if ($dinners[1] != null) {
            $dinner = $dinners[1];
        } else {
            $dinner = '';
        }
        $('.recipes_cont').append('&lt;div class="rcp_cnt">\
                                    &lt;a href="' + $urlRecipe + $recipe.id + '_dinner=' + $dinner + '">\
                                        &lt;div class="recipe ' + $classPlate + '">\
                                            &lt;img src="' + $recipe.image + '" alt="' + $classPlate + '" style="width: 100%;">\
                                            &lt;div class="desc_rec">\
                                                &lt;h3 id="title">' + $recipe.name + '&lt;/h3>\
                                                &lt;p id="author">' + $userAlias + '&lt;/p>\
                                            &lt;/div>\
                                        &lt;/div>\
                                        &lt;div class="info_rec">\
                                            &lt;p id="level">Dificultad: ' + $difficult + '&lt;/p>\
                                            &lt;div class="time_rec">\
                                                &lt;i class="fas fa-clock clock">&lt;/i>\
                                                &lt;p id="time">' + $recipe.recipeTime + ' min&lt;/p>\
                                            &lt;/div>\
                                        &lt;/div>\
                                        ' + $forks + '\
                                        &lt;/a>\
                                    &lt;/div>');
    }

    function getForks($forks) {
        let $insertForks = '&lt;div class="score_rec">';
        for (let i = 0; i &lt; $forks; i++) {
            $insertForks = $insertForks.concat('&lt;img src="/images/tenedor-gold.svg" alt="tenerdor" style="width: 20px; height: 40px;">');
        }
        if ($forks != 5) {
            let $numberForks = 5 - $forks;
            for (let i = 0; i &lt; $numberForks; i++) {
                $insertForks = $insertForks.concat('&lt;img src="/images/tenedor-black.svg" alt="tenerdor" style="width: 20px; height: 40px;">');
            }
        }
        $insertForks = $insertForks.concat('&lt;/div>');
        return $insertForks;
    }

    function getDifficult($dificult) {
        let $insertDificult = '';
        switch ($dificult) {
            case 0:
                return $insertDificult = 'Muy baja';
            case 1:
                return $insertDificult = 'Baja';
            case 2:
                return $insertDificult = 'Media';
            case 3:
                return $insertDificult = 'Difícil';
            case 4:
                return $insertDificult = 'Muy difícil';
        }
    }
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#$alias">$alias</a></li><li><a href="global.html#$allPlatesCakes">$allPlatesCakes</a></li><li><a href="global.html#$allPlatesDesserts">$allPlatesDesserts</a></li><li><a href="global.html#$allPlatesFirsts">$allPlatesFirsts</a></li><li><a href="global.html#$allPlatesSeconds">$allPlatesSeconds</a></li><li><a href="global.html#$allPlatesStarters">$allPlatesStarters</a></li><li><a href="global.html#$allTypePlate">$allTypePlate</a></li><li><a href="global.html#$allUsers">$allUsers</a></li><li><a href="global.html#$booleaDirection">$booleaDirection</a></li><li><a href="global.html#$booleanAlias">$booleanAlias</a></li><li><a href="global.html#$booleanBusinessPhone">$booleanBusinessPhone</a></li><li><a href="global.html#$booleanCity">$booleanCity</a></li><li><a href="global.html#$booleanCompany">$booleanCompany</a></li><li><a href="global.html#$booleanEmail">$booleanEmail</a></li><li><a href="global.html#$booleanName">$booleanName</a></li><li><a href="global.html#$booleanNif">$booleanNif</a></li><li><a href="global.html#$booleanPassword">$booleanPassword</a></li><li><a href="global.html#$booleanPc">$booleanPc</a></li><li><a href="global.html#$booleanSurname">$booleanSurname</a></li><li><a href="global.html#$businessPhone">$businessPhone</a></li><li><a href="global.html#$city">$city</a></li><li><a href="global.html#$company">$company</a></li><li><a href="global.html#$count">$count</a></li><li><a href="global.html#$countCakes">$countCakes</a></li><li><a href="global.html#$countDesserts">$countDesserts</a></li><li><a href="global.html#$countFirsts">$countFirsts</a></li><li><a href="global.html#$countSeconds">$countSeconds</a></li><li><a href="global.html#$countStarters">$countStarters</a></li><li><a href="global.html#$difficult">$difficult</a></li><li><a href="global.html#$direction">$direction</a></li><li><a href="global.html#$document">$document</a></li><li><a href="global.html#$email">$email</a></li><li><a href="global.html#$forks">$forks</a></li><li><a href="global.html#$ingredient">$ingredient</a></li><li><a href="global.html#$ingredientId">$ingredientId</a></li><li><a href="global.html#$ingredients">$ingredients</a></li><li><a href="global.html#$insert">$insert</a></li><li><a href="global.html#$latestRecipes">$latestRecipes</a></li><li><a href="global.html#$login">$login</a></li><li><a href="global.html#$name">$name</a></li><li><a href="global.html#$nif">$nif</a></li><li><a href="global.html#$numberPersons">$numberPersons</a></li><li><a href="global.html#$pass">$pass</a></li><li><a href="global.html#$pc">$pc</a></li><li><a href="global.html#$phone">$phone</a></li><li><a href="global.html#$pswrd">$pswrd</a></li><li><a href="global.html#$recipePlates">$recipePlates</a></li><li><a href="global.html#$screenSize">$screenSize</a></li><li><a href="global.html#$typePlate">$typePlate</a></li><li><a href="global.html#$url">$url</a></li><li><a href="global.html#$urlAllUsers">$urlAllUsers</a></li><li><a href="global.html#$urlIngredients">$urlIngredients</a></li><li><a href="global.html#$urlLatestRecipes">$urlLatestRecipes</a></li><li><a href="global.html#$urlLogin">$urlLogin</a></li><li><a href="global.html#$urlOrderByAssessment">$urlOrderByAssessment</a></li><li><a href="global.html#$urlRecipe">$urlRecipe</a></li><li><a href="global.html#$urlRecipes">$urlRecipes</a></li><li><a href="global.html#$urlType">$urlType</a></li><li><a href="global.html#$urlTypePlate">$urlTypePlate</a></li><li><a href="global.html#$userAlias">$userAlias</a></li><li><a href="global.html#$valueEnergMax">$valueEnergMax</a></li><li><a href="global.html#$valueEnergMin">$valueEnergMin</a></li><li><a href="global.html#addRequired">addRequired</a></li><li><a href="global.html#blur">blur</a></li><li><a href="global.html#checkCif">checkCif</a></li><li><a href="global.html#checkDocument">checkDocument</a></li><li><a href="global.html#checkLetter">checkLetter</a></li><li><a href="global.html#checkNie">checkNie</a></li><li><a href="global.html#checkNif">checkNif</a></li><li><a href="global.html#checkTypePlate">checkTypePlate</a></li><li><a href="global.html#getDificult">getDificult</a></li><li><a href="global.html#getForks">getForks</a></li><li><a href="global.html#insertPlates">insertPlates</a></li><li><a href="global.html#insertRecipe">insertRecipe</a></li><li><a href="global.html#loading">loading</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#receivePlate">receivePlate</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#urlTypePlate">urlTypePlate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue May 11 2021 17:13:18 GMT+0200 (hora de verano de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
